<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      var map;
			var marker;
			var distanceMatrixService;
			var srcLatlng;
			var destLatlng;
			var measureLine;

			function initMap() {
				srcLatlng = {lat: 40.412156, lng: -74.032638};
				destLatlng = {lat: 40.412156, lng: -74.030638};
				var defaultZoom = 14;

				map = new google.maps.Map(document.getElementById('map'), {
					center: srcLatlng,
					zoom: defaultZoom
				});

				distanceMatrixService = new google.maps.DistanceMatrixService();

				updateTime();

				sourceMarker = new google.maps.Marker({
					position: srcLatlng,
					map: map,
					title: 'Selected position',
					label: 'A',
					draggable: true
				});

				destMarker = new google.maps.Marker({
					position: destLatlng,
					map: map,
					title: 'Selected position',
					label: 'B',
					draggable: true
				});

				measureLine = new google.maps.Polyline({
					path: [srcLatlng, destLatlng],
					geodesic: true,
					strokeColor: '#FF0000',
					strokeOpacity: 1.0,
					strokeWeight: 2
				});
				measureLine.setMap(map);

				// marker updates
				map.addListener('click', function(event) {
					sourceMarker.setPosition(event.latLng);
					map.panTo(sourceMarker.getPosition());
					srcLatlng = sourceMarker.getPosition();
					updateTime();
					updateLine();
				});

				sourceMarker.addListener('dragend', function() {
					map.panTo(sourceMarker.getPosition());
					srcLatlng = sourceMarker.getPosition();
					updateTime();
					updateLine();
				});

				destMarker.addListener('dragend', function() {
					destLatlng = destMarker.getPosition();
					updateTime();
					updateLine();
				});

				// ui feature
				sourceMarker.addListener('click', function() {
					map.setZoom(defaultZoom),
					map.setCenter(sourceMarker.getPosition())
				});
			}

			function updateLine() {
				measureLine.setPath([srcLatlng, destLatlng]);
			}

			function updateTime() {
				distanceMatrixService.getDistanceMatrix({
					origins: [srcLatlng],
					destinations: [destLatlng],
					travelMode: 'WALKING'
				}, drawTime);
			}

			function drawTime(response, status) {
				response.rows[0].elements.forEach(function(element) {
					console.log(element)
					console.log("distance: " + element.distance.text + " duration: " + element.duration.text);
				});
			}

		</script>
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBX27SpSRS8d2C7_T0kjUUSKLXSOSlW--8&callback=initMap"
					async defer></script>
	</body>
</html>
